# VisionFlow

VisionFlow 是一个基于 **Qt + QtNodes + OpenCV** 构建的
**可视化图像处理流程编辑与执行工具**，用于通过节点流程方式搭建图像处理
pipeline，实现工业视觉流程的快速构建与扩展。

系统支持通过节点拖拽、连接方式构建数据流，并在点击运行按钮后执行整条处理链。

------------------------------------------------------------------------

## 当前功能概览

当前版本已实现：

### 可视化流程编辑

-   基于 QtNodes 的节点编辑界面
-   支持节点拖拽与连接
-   支持右键菜单创建节点
-   自动注册节点并分类显示
-   支持流程保存与加载（QtNodes 自带能力）

------------------------------------------------------------------------

### 图像处理节点

当前已实现基础图像处理流程：

ImageLoad → ImageGray → ImageMerge → ImageSave

支持节点：

#### ImageLoad

-   从文件加载图像
-   UI 中可选择图像路径
-   输出 OpenCV Mat 数据

#### ImageGray

-   输入彩色图像
-   输出灰度图像

#### ImageMerge

-   支持两路输入图像
-   支持拼接模式：
    -   横向拼接
    -   纵向拼接

#### ImageSave

-   保存图像到文件
-   UI 可选择输出路径

------------------------------------------------------------------------

### 执行控制

流程不会自动执行，需点击 **Run 按钮**：

Run → 执行整张流程图

执行过程：

1.  FlowRunner 遍历全部节点
2.  触发 dataUpdated
3.  QtNodes 自动传播数据流
4.  下游节点执行 setInData
5.  完成 pipeline

------------------------------------------------------------------------

### 执行耗时统计

当前支持：

-   流程总执行时间统计
-   每个节点执行耗时统计

用于后续性能优化。

------------------------------------------------------------------------

## 软件架构

系统整体分为四层：

### 1. UI 层

VisionFlowView\
↓\
FlowEditorWidget\
↓\
FlowView + FlowScene

职责： - 流程编辑界面 - 节点拖拽与连线 - 节点创建与删除 - Run
按钮执行流程

------------------------------------------------------------------------

### 2. Graph Model 层（QtNodes）

核心：

DataFlowGraphModel

管理： - 节点实例 - 连接关系 - 数据传播 - 保存/加载

------------------------------------------------------------------------

### 3. Node 节点层

所有节点继承：

NodeDelegateModel

每个节点实现：

-   setInData 接收数据
-   outData 输出数据
-   embeddedWidget UI

节点逻辑在此层完成。

------------------------------------------------------------------------

### 4. 执行层

FlowRunner

职责：

Run按钮 → FlowRunner::run\
　　　　　 ↓\
　　 触发节点数据传播\
　　　　　 ↓\
QtNodes 自动执行 pipeline

------------------------------------------------------------------------

## 当前目录结构（简化）

VisionFlow/

├─ ui/\
│ ├─ VisionFlowView\
│ └─ FlowEditorWidget

├─ flow/\
│ ├─ FlowRunner\
│ ├─ FlowScene\
│ └─ FlowExecutionContext

├─ nodes/\
│ ├─ ImageLoadNode\
│ ├─ ImageGrayNode\
│ ├─ ImageMergeNode\
│ └─ ImageSaveNode

├─ thirdparties/\
│ └─ QtNodes

└─ CMakeLists.txt

------------------------------------------------------------------------

## 当前设计目标

VisionFlow 的目标是构建：

-   工业视觉流程编辑器
-   可扩展节点系统
-   模块化执行引擎
-   插件化算法扩展

后续规划包括：

-   节点参数面板
-   执行调试模式
-   节点执行高亮
-   多线程执行
-   节点耗时可视化
-   插件式算法加载

------------------------------------------------------------------------

## 当前版本总结

当前已完成：

-   QtNodes 集成
-   OpenCV 集成
-   节点流程执行
-   图像加载处理保存
-   多输入节点支持
-   执行耗时统计

VisionFlow 已具备基础视觉流程处理能力。
